# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä C-–º–µ–Ω—é –¥–ª—è LCD1602

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω Python-–ø–∞–∫–µ—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ C-–∫–æ–¥–∞ —Å–∏—Å—Ç–µ–º—ã –º–µ–Ω—é –Ω–∞ –æ—Å–Ω–æ–≤–µ JSON-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –º–µ–Ω—é, –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, —Å–∏—Å—Ç–µ–º–∞ callback-—Ñ—É–Ω–∫—Ü–∏–π –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ C-–∫–æ–¥–∞.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **MenuConfig** - –∑–∞–≥—Ä—É–∑–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
2. **MenuData** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –¥–ª—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö, —Ä–æ–ª–µ–π –∏ callback-—Ñ—É–Ω–∫—Ü–∏–π
3. **FlatNode** - –ø–ª–æ—Å–∫–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —É–∑–ª–∞ –º–µ–Ω—é —Å–æ —Å–≤—è–∑—è–º–∏ (—Ä–æ–¥–∏—Ç–µ–ª—å, –¥–µ—Ç–∏, siblings)
4. **CallbackManager** - —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback-—Ñ—É–Ω–∫—Ü–∏–π
5. **MenuFlattener** - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ –≤ –ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ —Å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–º–∏ —Å–≤—è–∑—è–º–∏
6. **MenuValidator** - –≤–∞–ª–∏–¥–∞—Ü–∏—è JSON-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
7. **MenuProcessor** - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
8. **MenuGenerator** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è C-–∫–æ–¥–∞ —á–µ—Ä–µ–∑ Jinja-—à–∞–±–ª–æ–Ω—ã (–ø—Ä–µ–¥—Å—Ç–æ–∏—Ç –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å)

## JSON-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `config.json` - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥ —Å –ø—É—Ç—è–º–∏ –∫ –¥—Ä—É–≥–∏–º —Ñ–∞–π–ª–∞–º
- `menu_schema.json` - JSON Schema –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `menu.json` - –¥–µ—Ä–µ–≤–æ –º–µ–Ω—é —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
- `menu_data.json` - –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Ç–∏–ø–æ–≤, —Ä–æ–ª–µ–π, callback-—Ñ—É–Ω–∫—Ü–∏–π

### –°—Ö–µ–º–∞ menu.json:
```json
{
  "id": "unique_id",
  "title": "Display Name",
  "type": "ubyte|string|callback|...",
  "role": "simple|factor|fixed|callback",
  "controls": ["click", "position"], // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  "navigate": "cyclic|limit", // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  "click_cb": "custom_function", // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  "position_cb": "custom_function", // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  "double_click_cb": "custom_function", // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  "long_click_cb": "custom_function", // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  "event_cb": "custom_function", // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  "draw_value_cb": "custom_function", // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
  // ... –¥—Ä—É–≥–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
}
```

## –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### 1. –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π (role):
- **simple** - –ø—Ä–æ—Å—Ç—ã–µ —á–∏—Å–ª–æ–≤—ã–µ —Ç–∏–ø—ã
- **factor** - –∑–Ω–∞—á–µ–Ω–∏—è —Å –º–Ω–æ–∂–∏—Ç–µ–ª—è–º–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–±–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è)
- **fixed** - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞–±–æ—Ä—ã –∑–Ω–∞—á–µ–Ω–∏–π
- **callback** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

### 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª—è–º–∏ (controls):
- –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω `controls` –≤ JSON - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ
- –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–±–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è (–∫—Ä–æ–º–µ callback)
- –î–ª—è `factor` —Ä–æ–ª–∏ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–±–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è

### 3. Callback-—Ñ—É–Ω–∫—Ü–∏–∏:
- **6 —Ç–∏–ø–æ–≤ callback'–æ–≤**: click, position, double_click, long_click, event, draw_value
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏
- –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω –¥–ª—è draw_value_cb –ø–æ —à–∞–±–ª–æ–Ω—É: `menu_draw_{category}_value_cb`

### 4. –ù–∞–≤–∏–≥–∞—Ü–∏—è:
- **cyclic** - —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
- **limit** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ (–¥–æ –ø–µ—Ä–≤–æ–≥–æ/–ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞)
- –î–ª—è `click` –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `cyclic` –Ω–∞–≤–∏–≥–∞—Ü–∏—è

## –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ:
1. –ü–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è JSON-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
2. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ –≤ –ø–ª–æ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å —Å–≤—è–∑—è–º–∏
3. –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
4. Callback Manager —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π
5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω —Ñ—É–Ω–∫—Ü–∏–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (type + role)
6. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤ (MenuProcessor)

### üîÑ –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏:
1. **Jinja-—à–∞–±–ª–æ–Ω—ã** –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ C-–∫–æ–¥–∞
2. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
3. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π –æ—Ç—Ä–∏—Å–æ–≤–∫–∏** –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π  
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π C-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π**

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–≥–æ C-–∫–æ–¥–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `menu_struct.h` - —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∏ enum'—ã
- `menu_config.h/c` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–µ–Ω—é –∏ callback-—Ñ—É–Ω–∫—Ü–∏–π
- `menu_edit.c` - —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π
- `menu_draw.c` - —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–π
- `menu_tree.c` - –¥–µ—Ä–µ–≤–æ –º–µ–Ω—é —Å–æ —Å–≤—è–∑—è–º–∏

### –ü—Ä–∏–º–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:
```c
typedef struct {
    menu_id_t id;
    menu_category_t category;
    menu_click_cb_t click_cb;
    menu_position_cb_t position_cb;
    // ... –¥—Ä—É–≥–∏–µ callback'–∏
    union {
        ubyte_simple_config_t ubyte_simple;
        udword_factor_config_t udword_factor;
        // ... –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
    } data;
} menu_item_config_t;
```

## –ó–∞–¥–∞—á–∏ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è

### 1. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Jinja-—à–∞–±–ª–æ–Ω–æ–≤
- –®–∞–±–ª–æ–Ω—ã –¥–ª—è –≤—Å–µ—Ö –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö C-—Ñ–∞–π–ª–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π (type + role)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö callback-—Ñ—É–Ω–∫—Ü–∏–π

### 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –î–ª—è –≤—Å–µ—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π type + role + control + navigate
- –û—Å–æ–±—ã–µ —Å–ª—É—á–∞–∏ –¥–ª—è factor —Ä–æ–ª–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ cyclic/limit –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

### 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π –æ—Ç—Ä–∏—Å–æ–≤–∫–∏  
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö draw_value_cb
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è LCD

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º C-–∫–æ–¥–æ–º
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å menu_handle.c, menu_navigate.c –∏ —Ç.–¥.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–æ–¥-—Å—Ç–∞–π–ª—É –ø—Ä–æ–µ–∫—Ç–∞

## –¢–µ–∫—É—â–∏–µ Python-–º–æ–¥—É–ª–∏

```
menu_config.py      # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
menu_data.py        # –ü—Ä–∞–≤–∏–ª–∞ —Ç–∏–ø–æ–≤ –∏ —Ä–æ–ª–µ–π
flat_node.py        # –£–∑–µ–ª –º–µ–Ω—é (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)
callback_manager.py # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ callback-—Ñ—É–Ω–∫—Ü–∏—è–º–∏
menu_flattener.py   # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–µ—Ä–µ–≤–∞
menu_validator.py   # –í–∞–ª–∏–¥–∞—Ü–∏—è JSON
menu_processor.py   # –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä
menu_generator.py   # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä C-–∫–æ–¥–∞ (—Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏)
common.py          # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
```

## –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã –≤ –Ω–æ–≤–æ–º —á–∞—Ç–µ

–î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤ –Ω–æ–≤–æ–º —á–∞—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

1. **–ü–µ—Ä–µ–¥–∞—Ç—å —Ç–µ–∫—É—â–∏–µ —Ñ–∞–π–ª—ã** Python-–º–æ–¥—É–ª–µ–π
2. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã** –ø–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
4. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å** —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π C-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π —Ñ–∞–∑–µ - –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—á–µ–≥–æ C-–∫–æ–¥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –¥–∞–Ω–Ω—ã—Ö.